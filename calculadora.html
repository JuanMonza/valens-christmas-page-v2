<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="icon" href="medios/logo valents.PNG" type="image/png">
  <link rel="stylesheet" href="assets/styles.css" />
  <title>Calculadora Mágica - Valens Christmas</title>
</head>

<body style="background-image: url('medios/fondo-de-navidad-con-copos-de-nieve-y-luces-bokeh.jpg'); background-size: cover; background-position: center; background-attachment: fixed;">
  <canvas id="snow-canvas"
    style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:99999;opacity:0.7;"></canvas>
  
  <div id="navbar"></div>

  <main>
    <section id="calculadora" class="content-section"
        style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border-radius: 15px; margin: 20px auto; padding: 40px; max-width: 1200px;">
        <h2>Calculadora Mágica de Decoración</h2>
        <p style="max-width: 600px; margin: 0 auto 2rem; color: var(--color-dark);">Descubre la cantidad perfecta de
            adornos para crear tu árbol navideño soñado</p>
        <div class="magic-calculator-container">
            <div class="input-group">
                <label for="tree_height">Altura del árbol (en metros)</label>
                <input type="range" id="tree_height" class="tree-height-slider" name="tree_height" min="1" max="3" step="0.1" value="1.5">
                <div class="height-display-container">
                    <span id="height_display">1.5m</span>
                </div>
            </div>

            <fieldset>
                <legend>Tipo de árbol</legend>
                <div class="tree-options-container">
                    <label class="tree-option">
                        <input type="radio" name="tree_type" value="slim" checked>
                        <span class="tree-option-label">Delgado</span>
                    </label>
                    <label class="tree-option">
                        <input type="radio" name="tree_type" value="standard">
                        <span class="tree-option-label">Estándar</span>
                    </label>
                    <label class="tree-option">
                        <input type="radio" name="tree_type" value="dense">
                        <span class="tree-option-label">Frondoso</span>
                    </label>
                </div>
            </fieldset>

            <button id="calculate_btn" class="calculate-button">
                <i class="fas fa-magic"></i> Calcular
            </button>

            <div id="results" class="results-container">
                <h3>Tu árbol necesita:</h3>
                <div class="results-content">
                    <div class="result-item">
                        <span class="result-label"><i class="fas fa-star"></i> Esferas:</span>
                        <span id="res_ornaments" class="result-value">0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label"><i class="fas fa-ribbon"></i> Moños:</span>
                        <span id="res_bows" class="result-value">0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label"><i class="fas fa-stream"></i> Guirnalda:</span>
                        <span id="res_garland" class="result-value">0m</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label"><i class="fas fa-lightbulb"></i> Luces LED:</span>
                        <span id="res_lights" class="result-value">0</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
  </main>

  <div id="footer"></div>

  <script type="module">
        import { renderNavbar, navbarScript, stickyNavScript } from './assets/navbar.js';
        import { renderFooter } from './assets/footer.js';
        document.getElementById('navbar').innerHTML = renderNavbar();
        document.getElementById('footer').innerHTML = renderFooter();
        navbarScript();
        stickyNavScript();
    </script>

    <audio id="christmas-audio" loop preload="auto" style="display:none;">
        <source src="medios/christmas-party-time-249613.mp3" type="audio/mpeg">
    </audio>
    <script src="assets/music-persistence.js"></script>
    <script src="assets/snow-effect.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const treeHeightSlider = document.getElementById('tree_height');
      const heightDisplay = document.getElementById('height_display');
      const calculateBtn = document.getElementById('calculate_btn');
      const resultsDiv = document.getElementById('results');
      const treeOptions = document.querySelectorAll('.tree-option input');

      // --- Lógica para el llenado del slider ---
      function updateSliderFill() {
        const min = parseFloat(treeHeightSlider.min);
        const max = parseFloat(treeHeightSlider.max);
        const val = parseFloat(treeHeightSlider.value);
        const percentage = ((val - min) * 100) / (max - min);
        
        // Aplica el estilo para el efecto de llenado
        treeHeightSlider.style.setProperty('--slider-fill-percentage', `${percentage}%`);
        
        // Actualiza el texto del metraje
        heightDisplay.textContent = `${val.toFixed(1)}m`;
      }

      // Llama a la función una vez al cargar para establecer el estado inicial
      updateSliderFill();

      // Añade el listener para actualizar en cada movimiento
      treeHeightSlider.addEventListener('input', updateSliderFill);
      // --- Fin de la lógica del slider ---

      // Lógica para seleccionar tipo de árbol
      treeOptions.forEach(option => {
        option.addEventListener('change', function() {
          // Este código es para la selección visual, si es necesario
        });
      });

      calculateBtn.addEventListener('click', function () {
        const height = parseFloat(treeHeightSlider.value);
        const type = document.querySelector('input[name="tree_type"]:checked').value;

        let multiplier;
        if (type === 'slim') {
          multiplier = 0.8;
        } else if (type === 'standard') {
          multiplier = 1;
        } else { // dense
          multiplier = 1.3;
        }

        // Fórmulas de cálculo
        const ornaments = Math.round((height * 25) * multiplier);
        const bows = Math.round((height * 10) * multiplier);
        const garland = (height * 3).toFixed(1);
        const lights = Math.round(height * 100);

        document.getElementById('res_ornaments').textContent = ornaments;
        document.getElementById('res_bows').textContent = bows;
        document.getElementById('res_garland').textContent = `${garland}m`;
        document.getElementById('res_lights').textContent = lights;

        resultsDiv.style.opacity = 1; // Muestra los resultados
      });
    });
  </script>

</body>
</html>
